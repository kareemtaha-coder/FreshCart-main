"use strict";(self.webpackChunkEcommerce=self.webpackChunkEcommerce||[]).push([[99],{8099:(I,C,p)=>{p.r(C),p.d(C,{ForgotpasswordComponent:()=>q});var f=p(6814),i=p(95),e=p(4769),T=p(9410),F=p(2425),Z=p(1120);function b(t,m){1&t&&(e.TgZ(0,"p"),e._uU(1," Please enter your email. "),e.qZA())}function l(t,m){1&t&&(e.TgZ(0,"p"),e._uU(1," Email must be valid! "),e.qZA())}function g(t,m){if(1&t&&(e.TgZ(0,"div",21),e.YNc(1,b,2,0,"p",22),e.YNc(2,l,2,0,"p",22),e.qZA()),2&t){const s=e.oxw();let n,o;e.xp6(1),e.Q6J("ngIf",null==(n=s.forgotPasswordForm.get("email"))?null:n.getError("required")),e.xp6(1),e.Q6J("ngIf",null==(o=s.forgotPasswordForm.get("email"))?null:o.getError("email"))}}function r(t,m){1&t&&e._UZ(0,"i",23)}function u(t,m){if(1&t&&(e.TgZ(0,"p",24),e._uU(1),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.hij(" ",s.errMsg," ")}}function P(t,m){1&t&&(e.TgZ(0,"p"),e._uU(1," Code is required. "),e.qZA())}function v(t,m){1&t&&(e.TgZ(0,"p"),e._uU(1," Code must be valid! "),e.qZA())}function A(t,m){if(1&t&&(e.TgZ(0,"div",21),e.YNc(1,P,2,0,"p",22),e.YNc(2,v,2,0,"p",22),e.qZA()),2&t){const s=e.oxw();let n,o;e.xp6(1),e.Q6J("ngIf",null==(n=s.resetCodeForm.get("resetCode"))?null:n.getError("required")),e.xp6(1),e.Q6J("ngIf",null==(o=s.resetCodeForm.get("resetCode"))?null:o.getError("minLength","maxLength"))}}function U(t,m){1&t&&e._UZ(0,"i",23)}function x(t,m){if(1&t&&(e.TgZ(0,"p",24),e._uU(1),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.hij(" ",s.errMsg," ")}}function E(t,m){1&t&&(e.TgZ(0,"p"),e._uU(1," Please enter your new password. "),e.qZA())}function M(t,m){1&t&&(e.TgZ(0,"p"),e._uU(1," Password must be 6 charcters at least! "),e.qZA())}function J(t,m){if(1&t&&(e.TgZ(0,"div",21),e.YNc(1,E,2,0,"p",22),e.YNc(2,M,2,0,"p",22),e.qZA()),2&t){const s=e.oxw();let n,o;e.xp6(1),e.Q6J("ngIf",null==(n=s.resetPasswordForm.get("newPassword"))?null:n.getError("required")),e.xp6(1),e.Q6J("ngIf",null==(o=s.resetPasswordForm.get("newPassword"))?null:o.getError("pattern"))}}function N(t,m){1&t&&e._UZ(0,"i",23)}function L(t,m){if(1&t&&(e.TgZ(0,"p",24),e._uU(1),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.hij(" ",s.errMsg," ")}}let q=(()=>{class t{constructor(s,n,o,a,d){this._AuthService=s,this._FormBuilder=n,this._ToastrService=o,this._Router=a,this._Renderer2=d,this.isLoading=!1,this.errMsg="",this.userEmail="",this.forgotPasswordForm=this._FormBuilder.group({email:["",{validators:[i.kI.required,i.kI.email]}]}),this.resetCodeForm=this._FormBuilder.group({resetCode:["",{validators:[i.kI.required,i.kI.minLength(5),i.kI.maxLength(6)]}]}),this.resetPasswordForm=this._FormBuilder.group({email:[""],newPassword:["",{validators:[i.kI.required,i.kI.pattern(/^\w{6,}$/)]}]})}handleForm(s,n){this.isLoading=!0;const o=this.forgotPasswordForm.value;this.userEmail=o.email,this._AuthService.forgotPassword(o).subscribe({next:a=>{this.isLoading=!1,this._ToastrService.success(a.message),this._Renderer2.removeClass(n,"d-none"),this._Renderer2.addClass(s,"d-none")},error:a=>{this.isLoading=!1,this.errMsg=a.error.message}})}handleResetForm(s,n,o){this.isLoading=!0,this.errMsg="",this._AuthService.resetCode(this.resetCodeForm.value).subscribe({next:d=>{"Success"==d.status&&(this.isLoading=!1,this._Renderer2.removeClass(n,"d-none"),this._Renderer2.addClass(s,"d-none"),this._Renderer2.setAttribute(o,"disabled","true"))},error:d=>{this.isLoading=!1,this.errMsg=d.error.message}})}handleNewPasswordForm(){this.isLoading=!0,this.errMsg="";const s=this.resetPasswordForm.value;s.email=this.userEmail,this._AuthService.resetPassword(s).subscribe({next:n=>{this.isLoading=!1,localStorage.setItem("_token",n.token),this._Router.navigate(["/home"])},error:n=>{this.isLoading=!1,this.errMsg=n.error.message}})}static#e=this.\u0275fac=function(n){return new(n||t)(e.Y36(T.e),e.Y36(i.qu),e.Y36(F._W),e.Y36(Z.F0),e.Y36(e.Qsj))};static#o=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-forgotpassword"]],standalone:!0,features:[e.jDz],decls:42,vars:22,consts:[[1,"rounded-2","shadow-sm","w-75","mx-auto","bg-main-light","p-5",3,"formGroup","ngSubmit"],["forgotPassForm",""],[1,"form-item","mb-2"],[1,"form-floating"],["type","email","id","email","formControlName","email","placeholder","enter your email",1,"form-control"],["for","email"],["class","text-invalid",4,"ngIf"],["type","submit",1,"main-btn","rounded-pill","px-3","py-2","mt-2",3,"disabled"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["class","text-invalid mx-auto content-fit mt-3",4,"ngIf"],[1,"rounded-2","shadow-sm","w-75","mx-auto","bg-main-light","p-5","d-none",3,"formGroup","ngSubmit"],["codeForm",""],["type","text","id","resetCode","formControlName","resetCode","placeholder","enter your code",1,"form-control"],["for","resetCode",1,"mb-1"],["newPassForm",""],[1,"form-item","mb-3"],["type","email","id","email2","formControlName","email","placeholder","email",1,"form-control","mb-2",3,"value"],["emailInput",""],["for","email2"],["type","password","id","newPassword","formControlName","newPassword","placeholder","enter your new password",1,"form-control"],["for","newPassword"],[1,"text-invalid"],[4,"ngIf"],[1,"fa-solid","fa-circle-notch","fa-spin"],[1,"text-invalid","mx-auto","content-fit","mt-3"]],template:function(n,o){if(1&n){const a=e.EpF();e.TgZ(0,"form",0,1),e.NdJ("ngSubmit",function(){e.CHM(a);const _=e.MAs(1),c=e.MAs(13);return e.KtG(o.handleForm(_,c))}),e.TgZ(2,"div",2)(3,"div",3),e._UZ(4,"input",4),e.TgZ(5,"label",5),e._uU(6,"Email:"),e.qZA()(),e.YNc(7,g,3,2,"div",6),e.qZA(),e.TgZ(8,"button",7),e._uU(9," Next "),e.YNc(10,r,1,0,"i",8),e.qZA(),e.YNc(11,u,2,1,"p",9),e.qZA(),e.TgZ(12,"form",10,11),e.NdJ("ngSubmit",function(){e.CHM(a);const _=e.MAs(13),c=e.MAs(25),h=e.MAs(29);return e.KtG(o.handleResetForm(_,c,h))}),e.TgZ(14,"div",2)(15,"div",3),e._UZ(16,"input",12),e.TgZ(17,"label",13),e._uU(18,"Reset Code:"),e.qZA()(),e.YNc(19,A,3,2,"div",6),e.qZA(),e.TgZ(20,"button",7),e._uU(21," Confirm "),e.YNc(22,U,1,0,"i",8),e.qZA(),e.YNc(23,x,2,1,"p",9),e.qZA(),e.TgZ(24,"form",10,14),e.NdJ("ngSubmit",function(){return o.handleNewPasswordForm()}),e.TgZ(26,"div",15)(27,"div",3),e._UZ(28,"input",16,17),e.TgZ(30,"label",18),e._uU(31,"Email:"),e.qZA()()(),e.TgZ(32,"div",15)(33,"div",3),e._UZ(34,"input",19),e.TgZ(35,"label",20),e._uU(36,"New password:"),e.qZA()(),e.YNc(37,J,3,2,"div",6),e.qZA(),e.TgZ(38,"button",7),e._uU(39," Change password "),e.YNc(40,N,1,0,"i",8),e.qZA(),e.YNc(41,L,2,1,"p",9),e.qZA()}if(2&n){let a,d,_,c,h,w;e.Q6J("formGroup",o.forgotPasswordForm),e.xp6(4),e.Tol(null!=(a=o.forgotPasswordForm.get("email"))&&a.errors&&(null!=(a=o.forgotPasswordForm.get("email"))&&a.touched||(null==(a=o.forgotPasswordForm.get("email"))?null:a.value.length)>0)?"is-invalid":""),e.xp6(3),e.Q6J("ngIf",(null==(d=o.forgotPasswordForm.get("email"))?null:d.errors)&&((null==(d=o.forgotPasswordForm.get("email"))?null:d.touched)||(null==(d=o.forgotPasswordForm.get("email"))?null:d.value.length)>0)),e.xp6(1),e.Q6J("disabled",o.forgotPasswordForm.invalid),e.xp6(2),e.Q6J("ngIf",o.isLoading),e.xp6(1),e.Q6J("ngIf",o.errMsg),e.xp6(1),e.Q6J("formGroup",o.resetCodeForm),e.xp6(4),e.Tol(null!=(_=o.resetCodeForm.get("resetCode"))&&_.errors&&(null!=(_=o.resetCodeForm.get("resetCode"))&&_.touched||(null==(_=o.resetCodeForm.get("resetCode"))?null:_.value.length)>0)?"is-invalid":""),e.xp6(3),e.Q6J("ngIf",(null==(c=o.resetCodeForm.get("resetCode"))?null:c.errors)&&((null==(c=o.resetCodeForm.get("resetCode"))?null:c.touched)||(null==(c=o.resetCodeForm.get("resetCode"))?null:c.value.length)>0)),e.xp6(1),e.Q6J("disabled",o.resetCodeForm.invalid),e.xp6(2),e.Q6J("ngIf",o.isLoading),e.xp6(1),e.Q6J("ngIf",o.errMsg),e.xp6(1),e.Q6J("formGroup",o.resetPasswordForm),e.xp6(4),e.Q6J("value",o.userEmail),e.xp6(6),e.Tol(null!=(h=o.resetPasswordForm.get("newPassword"))&&h.errors&&(null!=(h=o.resetPasswordForm.get("newPassword"))&&h.touched||(null==(h=o.resetPasswordForm.get("newPassword"))?null:h.value.length)>0)?"is-invalid":""),e.xp6(3),e.Q6J("ngIf",(null==(w=o.resetPasswordForm.get("newPassword"))?null:w.errors)&&((null==(w=o.resetPasswordForm.get("newPassword"))?null:w.touched)||(null==(w=o.resetPasswordForm.get("newPassword"))?null:w.value.length)>0)),e.xp6(1),e.Q6J("disabled",o.resetPasswordForm.invalid),e.xp6(2),e.Q6J("ngIf",o.isLoading),e.xp6(1),e.Q6J("ngIf",o.errMsg)}},dependencies:[f.ez,f.O5,i.UX,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u]})}return t})()},9410:(I,C,p)=>{p.d(C,{e:()=>b});class f extends Error{}f.prototype.name="InvalidTokenError";var F=p(4769),Z=p(9862);let b=(()=>{class l{constructor(r){this._HttpClient=r,this.baseUrl="https://ecommerce.routemisr.com/api/v1/auth/"}register(r){return this._HttpClient.post(this.baseUrl+"signup",r)}login(r){return this._HttpClient.post(this.baseUrl+"signin",r)}forgotPassword(r){return this._HttpClient.post(this.baseUrl+"forgotPasswords",r)}resetCode(r){return this._HttpClient.post(this.baseUrl+"verifyResetCode",r)}resetPassword(r){return this._HttpClient.put(this.baseUrl+"resetPassword",r)}decodeUser(){const r=localStorage.getItem("_token");if(null!==r){const u=function T(l,g){if("string"!=typeof l)throw new f("Invalid token specified: must be a string");g||(g={});const r=!0===g.header?0:1,u=l.split(".")[r];if("string"!=typeof u)throw new f(`Invalid token specified: missing part #${r+1}`);let P;try{P=function e(l){let g=l.replace(/-/g,"+").replace(/_/g,"/");switch(g.length%4){case 0:break;case 2:g+="==";break;case 3:g+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function i(l){return decodeURIComponent(atob(l).replace(/(.)/g,(g,r)=>{let u=r.charCodeAt(0).toString(16).toUpperCase();return u.length<2&&(u="0"+u),"%"+u}))}(g)}catch{return atob(g)}}(u)}catch(v){throw new f(`Invalid token specified: invalid base64 for part #${r+1} (${v.message})`)}try{return JSON.parse(P)}catch(v){throw new f(`Invalid token specified: invalid json for part #${r+1} (${v.message})`)}}(r);this.userInfo=u}}static#e=this.\u0275fac=function(u){return new(u||l)(F.LFG(Z.eN))};static#o=this.\u0275prov=F.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()}}]);